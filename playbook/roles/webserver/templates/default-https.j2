server {
	listen 443 ssl;
        {% for host, value in servers|items %}{% if host == ansible_hostname %}{% if value.ipv6 %}listen [::]:443 ssl;
        {% endif %}

	root /var/www/html;

	index index.html index.htm index.nginx-debian.html;

	server_name {{ value.vmname }}.{{ value.domain }};

        {% if value.generatecert %}ssl_certificate /etc/nginx/ssl/{{ host }}.crt;
        ssl_certificate_key /etc/nginx/ssl/{{ host }}.key;
        {% else %}
        ssl_certificate /etc/nginx/ssl/{{ value.certfile }};
        ssl_certificate_key /etc/nginx/ssl/{{ value.keyfile }};
{% endif %}
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv3:+EXP;
        ssl_prefer_server_ciphers on;

	location / {
		try_files $uri $uri/ =404;
	}
{% endif %}{% endfor %}}
